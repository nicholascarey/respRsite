<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Intermittent-flow respirometry: Complex example • respR</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha256-916EbMg70RQy9LHiGkXzG8hSg9EdNy97GazNG/aiY1w=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/all.min.css" integrity="sha256-nAmazAk6vS34Xqo0BSrTb+abbtFlgsFK7NKSi6o7Y78=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/v4-shims.min.css" integrity="sha256-6qHlizsOWFskGlwVOKuns+D1nB6ssZrHQrNj1wGplHc=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/headroom.min.js" integrity="sha256-DJFC1kqIhelURkuza0AvYal5RxMtpzLjFhsnVIeuk+U=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Intermittent-flow respirometry: Complex example">
<meta property="og:description" content="">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-inverse navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">respR</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">1.1.0.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home"></span>
     
  </a>
</li>
<li>
  <a href="../articles/respR.html">Getting Started</a>
</li>
<li>
  <a href="../reference/index.html">List of Functions</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Documentation
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/importing.html">Importing your data</a>
    </li>
    <li>
      <a href="../articles/auto_rate.html">auto_rate: Automatic detection of linear rates</a>
    </li>
    <li>
      <a href="../articles/closed.html">Closed-chamber respirometry</a>
    </li>
    <li>
      <a href="../articles/intermittent.html">Intermittent-flow respirometry: Simple example</a>
    </li>
    <li>
      <a href="../articles/intermittent2.html">Intermittent-flow respirometry: Complex example</a>
    </li>
    <li>
      <a href="../articles/flowthrough.html">Flowthrough respirometry</a>
    </li>
    <li>
      <a href="../articles/pcrit.html">Pcrit analysis</a>
    </li>
    <li>
      <a href="../articles/twopoint.html">Two-point analysis</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Discussion
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/performance.html">auto_rate: Performance in detecting linear regions</a>
    </li>
    <li>
      <a href="../articles/auto_rate_comp.html">auto_rate: Comparisons with LoLinR</a>
    </li>
    <li>
      <a href="../articles/packages_comp.html">respR: Comparisons with other R packages</a>
    </li>
    <li>
      <a href="../articles/tidyverse.html">respR: Integration with the tidyverse</a>
    </li>
    <li>
      <a href="../articles/reproducibility.html">respR: Reporting reproducible analyses</a>
    </li>
    <li>
      <a href="../articles/usage.html">respR: When to use respR</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/januarharianto/respr">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="intermittent2_files/header-attrs-2.1/header-attrs.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>Intermittent-flow respirometry: Complex example</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/januarharianto/respr/blob/master/vignettes/intermittent2.Rmd"><code>vignettes/intermittent2.Rmd</code></a></small>
      <div class="hidden name"><code>intermittent2.Rmd</code></div>

    </div>

    
    
<p>This vignette shows a more complex intermittent-flow analysis from a lengthy experiment, with numerous replicates of equal duration (except the first one) and a background rate that changes over the course of the experiment. This type of experiment is one many fish physiologists in particular will be familiar with. <code>respR</code> will in the future support these experiments in a much better way, but for now they are easily analysed with a little data manipulation.</p>
<p>The example data (<code>zeb_intermittent.rd</code>) has kindly been provided by Davide Thambithurai (University of Glasgow), and is from an experiment on a zebrafish. Note, the data has been injected with random noise, and volumes and masses used are not the actual values from the experiment.</p>
<div id="experiment-overview" class="section level2">
<h2 class="hasAnchor">
<a href="#experiment-overview" class="anchor"></a>Experiment overview</h2>
<p>From this experiment dataset we want to extract several metrics:</p>
<ol style="list-style-type: decimal">
<li><p><em>Pre- and post-experiment background rates</em>. Background rates were recorded at the start and end of the experiment (initial and end sections with shallow slopes). Because this is a lengthy experiment, in high temperatures, the microbial background rate actually increases over the course of the experiment. We will assume this increase is constant (i.e. linear) over the course of the experiment, and each replicate will be corrected with a background rate calculated according to where it occurs along the experiment (i.e. later replicates will be corrected by a greater amount).</p></li>
<li><p><em>Maximum metabolic rate (MMR)</em>. Before this experiment, the fish has been exercised to exhaustion, then placed in the respirometer, so the first replicate during which it is recovering from this exercise will represent MMR. This replicate is 14 minutes duration (13 minutes recording, 1 minute flushing), all the other replicates are 11 minutes in duration (10 minutes recording, 1 minute flushing). See <code><a href="../reference/zeb_intermittent.rd.html">?zeb_intermittent.rd</a></code> for row locations of all stages.</p></li>
<li><p><em>Routine metabolic rate (RMR)</em>. This will be calculated from the later replicates once the animal has recovered and is using oxygen only to fuel basal metabolism and minor, spontaneous movement.</p></li>
</ol>
</div>
<div id="loading-and-inspecting-data" class="section level2">
<h2 class="hasAnchor">
<a href="#loading-and-inspecting-data" class="anchor"></a>Loading and inspecting data</h2>
<p>We use <code><a href="../reference/inspect.html">inspect()</a></code> to preview the data and save it to an object. This is a <strong>very</strong> large dataset (nearly 80,000 records), so if running the code in this vignette be warned that operations may take some time.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1"></a>zeb &lt;-<span class="st"> </span><span class="kw"><a href="../reference/inspect.html">inspect</a></span>(zeb_intermittent.rd)</span></code></pre></div>
<p><img src="intermittent2_files/figure-html/unnamed-chunk-2-1.png" width="700"></p>
<p>Because this is a lengthy experiment, the data is too dense to inspect easily from the plots. Here we’ll inspect a portion at the start to illustrate the structure.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1"></a><span class="kw"><a href="../reference/inspect.html">inspect</a></span>(zeb_intermittent.rd[<span class="dv">1</span><span class="op">:</span><span class="dv">18000</span>, ])</span></code></pre></div>
<p><img src="intermittent2_files/figure-html/unnamed-chunk-3-1.png" width="700"></p>
<p>The top plot shows the initial background recording, then experimental replicates where O2 decreases, separated by regular flushes where it increases back to ambient levels. The bottom plot (a rate over a rolling window of 10% of the entire data), is not really useful as this window will cover several different replicates, but we can clearly see rates are higher at the start of the data.</p>
</div>
<div id="calculating-background-rate" class="section level2">
<h2 class="hasAnchor">
<a href="#calculating-background-rate" class="anchor"></a>Calculating background rate</h2>
<p>The intial and end sections will be used to calculate background rates, and how they change over the course of the experiment. Timepoints of these will typically have been recorded as part of the experiment, so can be used to extract the relevant sections (see <code><a href="../reference/zeb_intermittent.rd.html">?zeb_intermittent.rd</a></code> for row locations of all stages).</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1"></a><span class="co">## subset background recordings</span></span>
<span id="cb3-2"><a href="#cb3-2"></a>backg_start &lt;-<span class="st"> </span><span class="kw"><a href="../reference/subset_data.html">subset_data</a></span>(zeb, <span class="dt">from =</span> <span class="dv">0</span>, <span class="dt">to =</span> <span class="dv">4999</span>, <span class="dt">by =</span> <span class="st">"time"</span>)</span>
<span id="cb3-3"><a href="#cb3-3"></a>backg_end &lt;-<span class="st"> </span><span class="kw"><a href="../reference/subset_data.html">subset_data</a></span>(zeb, <span class="dt">from =</span> <span class="dv">75140</span>, <span class="dt">to =</span> <span class="dv">79251</span>, <span class="dt">by =</span> <span class="st">"time"</span>)</span>
<span id="cb3-4"><a href="#cb3-4"></a></span>
<span id="cb3-5"><a href="#cb3-5"></a><span class="co">## Calc initial and end bg rates</span></span>
<span id="cb3-6"><a href="#cb3-6"></a>bg_start &lt;-<span class="st"> </span><span class="kw"><a href="../reference/calc_rate.bg.html">calc_rate.bg</a></span>(backg_start)</span>
<span id="cb3-7"><a href="#cb3-7"></a>bg_end &lt;-<span class="st"> </span><span class="kw"><a href="../reference/calc_rate.bg.html">calc_rate.bg</a></span>(backg_end)</span></code></pre></div>
<p><img src="intermittent2_files/figure-html/unnamed-chunk-4-1.png" width="700"></p>
<p>The two different background rates (only the end one shown above) have been saved to these two objects. Support for a dynamic background rate within <code><a href="../reference/calc_rate.bg.html">calc_rate.bg()</a></code> is in our future development plans, but for now we can use the two rates to derive a linear relationship for the rate to apply based on time along the experiment. We will use these later to correct rates for background.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1"></a><span class="co">## extract bg rates and median timepoints</span></span>
<span id="cb4-2"><a href="#cb4-2"></a>r1 &lt;-<span class="st"> </span>bg_start<span class="op">$</span>bgrate</span>
<span id="cb4-3"><a href="#cb4-3"></a>r2 &lt;-<span class="st"> </span>bg_end<span class="op">$</span>bgrate</span>
<span id="cb4-4"><a href="#cb4-4"></a></span>
<span id="cb4-5"><a href="#cb4-5"></a>t1 &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/stats/median.html">median</a></span>(bg_start<span class="op">$</span>data<span class="op">$</span>Time)</span>
<span id="cb4-6"><a href="#cb4-6"></a>t2 &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/stats/median.html">median</a></span>(bg_end<span class="op">$</span>data<span class="op">$</span>Time)</span>
<span id="cb4-7"><a href="#cb4-7"></a></span>
<span id="cb4-8"><a href="#cb4-8"></a><span class="co">## fit lm</span></span>
<span id="cb4-9"><a href="#cb4-9"></a>bg_lm &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(r1, r2) <span class="op">~</span><span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(t1, t2))</span>
<span id="cb4-10"><a href="#cb4-10"></a></span>
<span id="cb4-11"><a href="#cb4-11"></a><span class="co">## extract slope and intercept</span></span>
<span id="cb4-12"><a href="#cb4-12"></a>bg_lm_int &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/stats/coef.html">coef</a></span>(bg_lm)[<span class="dv">1</span>]</span>
<span id="cb4-13"><a href="#cb4-13"></a>bg_lm_slp &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/stats/coef.html">coef</a></span>(bg_lm)[<span class="dv">2</span>]</span></code></pre></div>
<p>We will use these later to derive correction values based on time elapsed during the experiment.</p>
</div>
<div id="calculating-mmr" class="section level2">
<h2 class="hasAnchor">
<a href="#calculating-mmr" class="anchor"></a>Calculating MMR</h2>
<p>Here we calculate MMR using the first replicate. This replicate is longer than the others (14 mins/840 rows vs. 11 mins/660 rows for all others). For this (and the later analyses) we are going to apply a buffer value at the start of each rep. In this experiment, each replicate is comprises a recording period (13 mins for first rep, 10 mins for all others), followed by 1 minute of flushing. It is good practice to allow a period of settling after flushing, in case the animal was disturbed, or the O2 probe has some lag in detecting the O2 concentration or slight temperature difference. For all analyses we are going to use a 3 minute buffer (180s), that is we won’t use the first 3 mins of data in any rep. We will also only use 7 minutes (420 rows) of data after this so the flush period is not used. Here, we subset the first replicate out to a separate object using these parameters, and use <code><a href="../reference/auto_rate.html">auto_rate()</a></code> to find the most linear section (we could also use the <code>method = "max"</code> option to find the maximum linear rate <em>within</em> this replicate).</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1"></a><span class="co">## subset rep 1</span></span>
<span id="cb5-2"><a href="#cb5-2"></a>zeb_rep_<span class="dv">1</span> &lt;-<span class="st"> </span><span class="kw"><a href="../reference/subset_data.html">subset_data</a></span>(zeb, <span class="dt">from =</span> <span class="dv">5000</span> <span class="op">+</span><span class="st"> </span><span class="dv">180</span>, <span class="dt">to =</span> <span class="dv">5000</span> <span class="op">+</span><span class="st"> </span><span class="dv">180</span> <span class="op">+</span><span class="st"> </span><span class="dv">420</span>, <span class="dt">by =</span> <span class="st">"time"</span>)</span></code></pre></div>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1"></a><span class="co">## Find most linear section</span></span>
<span id="cb6-2"><a href="#cb6-2"></a>zeb_mmr &lt;-<span class="st"> </span><span class="kw"><a href="../reference/auto_rate.html">auto_rate</a></span>(zeb_rep_<span class="dv">1</span>)</span>
<span id="cb6-3"><a href="#cb6-3"></a><span class="co">#&gt; </span></span>
<span id="cb6-4"><a href="#cb6-4"></a><span class="co">#&gt; 3 kernel density peaks detected and ranked.</span></span></code></pre></div>
<p><img src="intermittent2_files/figure-html/unnamed-chunk-7-1.png" width="700"></p>
<p>We also need to adjust the rate for background. We will use the background linear model coefficients from above, with the start time of this replicate to calculate the appropriate background rate to apply (because this is the first replicate we could also just use the background rate we calculated from the initial background recording, i.e. <code>bg_start</code>).</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1"></a><span class="co">## adjust for background</span></span>
<span id="cb7-2"><a href="#cb7-2"></a>zeb_mmr_adj &lt;-<span class="st"> </span><span class="kw"><a href="../reference/adjust_rate.html">adjust_rate</a></span>(zeb_mmr, <span class="dt">by =</span> <span class="dv">5180</span> <span class="op">*</span><span class="st"> </span>bg_lm_slp <span class="op">+</span><span class="st"> </span>bg_lm_int)</span>
<span id="cb7-3"><a href="#cb7-3"></a><span class="co">#&gt; </span></span>
<span id="cb7-4"><a href="#cb7-4"></a><span class="co">#&gt; Rate adjustments applied. Use print() command for more info.</span></span>
<span id="cb7-5"><a href="#cb7-5"></a><span class="kw"><a href="https://rdrr.io/r/base/print.html">print</a></span>(zeb_mmr_adj)</span>
<span id="cb7-6"><a href="#cb7-6"></a><span class="co">#&gt; </span></span>
<span id="cb7-7"><a href="#cb7-7"></a><span class="co">#&gt; # adjust_rate # -------------------------</span></span>
<span id="cb7-8"><a href="#cb7-8"></a><span class="co">#&gt; Note: please consider the sign of the value while correcting the rate.</span></span>
<span id="cb7-9"><a href="#cb7-9"></a><span class="co">#&gt; </span></span>
<span id="cb7-10"><a href="#cb7-10"></a><span class="co">#&gt; Rank/position 1 result shown. To see all results use summary().</span></span>
<span id="cb7-11"><a href="#cb7-11"></a><span class="co">#&gt; Input rate: -0.00586741</span></span>
<span id="cb7-12"><a href="#cb7-12"></a><span class="co">#&gt; Adjustment: -7.586837e-05</span></span>
<span id="cb7-13"><a href="#cb7-13"></a><span class="co">#&gt; Adj. rate: -0.005791542</span></span></code></pre></div>
<p>That’s it: the MMR has been calculated, adjusted and saved, and we can see from the output plots everything looks good. We will convert it to units at the end of the vignette.</p>
</div>
<div id="calculating-rmr" class="section level2">
<h2 class="hasAnchor">
<a href="#calculating-rmr" class="anchor"></a>Calculating RMR</h2>
<p>Calculating RMR is a little more complex. Typically, SMR and RMR are defined as the lowest rates observed. What you choose to use will depend on many factors unique to your experiment, whether that be the absolute lowest rate found, or a representative mean of several low rates. The following is merely to show how you can use <code>respR</code> to explore and extract rates from multiple replicates.</p>
<p>Manually specifying the subsetting criteria for each subequent rep would be onerous, but since we know they cycle at 11 minutes (660s) and there are 105 further replicates after the first ends at row 5839, we can use straightforward R syntax. This is information that will have been recorded as part of the experiment.</p>
<p>There are a number of approaches we could use, but here we will show a simple <code>for</code> loop to run <code><a href="../reference/auto_rate.html">auto_rate()</a></code> for each replicate from the start of the second replicate (at row 5840), with a starting buffer of 3 minutes (180s), until 7 minutes (420s) later. These data have O2 recorded once per second, so row numbers can be used like this, but it will depend on the time data units used. For this example, we need to specify the original dataframe saved within the <code>zeb</code> object we created using <code><a href="../reference/inspect.html">inspect()</a></code> (i.e. <code>zeb$dataframe</code>) for the R subsetting syntax to work.</p>
<p>Again, a number of approaches could be used to subset data or iterate the functions to analyse these types of experiment; this is merely a simple example to illustrate how <code>respR</code> can be easily iterated over multiple replicates (a more succinct example is at the end of this vignette). Note, for simplicity, we will extract and save only the <em>rate value</em> found. Best practice would be to save the <code><a href="../reference/auto_rate.html">auto_rate()</a></code> object for each iteration of the loop (i.e. each replicate) in a <code>list</code> object (see eg. at end). We also save the start time of each rep to use later to calculate the correct background rate. Also, while it will greatly increase the time taken, for actual analyses it is <strong>highly</strong> recommended you examine the plot of each iteration, or at very least those that you use. Here in the interests of speed we suppress it with <code>plot = FALSE</code>.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1"></a><span class="co">## set start rows for each rep using sequence function (from, to, by)</span></span>
<span id="cb8-2"><a href="#cb8-2"></a>s_r &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/seq.html">seq</a></span>(<span class="dv">5840</span>, <span class="dv">74480</span>, <span class="dv">660</span>)</span>
<span id="cb8-3"><a href="#cb8-3"></a><span class="co">## apply buffer of 3 mins/180s</span></span>
<span id="cb8-4"><a href="#cb8-4"></a>s_r &lt;-<span class="st"> </span>s_r <span class="op">+</span><span class="st"> </span><span class="dv">180</span></span>
<span id="cb8-5"><a href="#cb8-5"></a><span class="co">## set end rows for each rep - 7 mins/420s later</span></span>
<span id="cb8-6"><a href="#cb8-6"></a>e_r &lt;-<span class="st"> </span>s_r <span class="op">+</span><span class="st"> </span><span class="dv">420</span></span>
<span id="cb8-7"><a href="#cb8-7"></a></span>
<span id="cb8-8"><a href="#cb8-8"></a><span class="co">## for saving results</span></span>
<span id="cb8-9"><a href="#cb8-9"></a>rmr_rates &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span>()</span>
<span id="cb8-10"><a href="#cb8-10"></a></span>
<span id="cb8-11"><a href="#cb8-11"></a><span class="co">## loop</span></span>
<span id="cb8-12"><a href="#cb8-12"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="dv">105</span>) {</span>
<span id="cb8-13"><a href="#cb8-13"></a>    </span>
<span id="cb8-14"><a href="#cb8-14"></a>    sr &lt;-<span class="st"> </span>s_r[i]  <span class="co"># start row</span></span>
<span id="cb8-15"><a href="#cb8-15"></a>    er &lt;-<span class="st"> </span>e_r[i]  <span class="co"># end row</span></span>
<span id="cb8-16"><a href="#cb8-16"></a>    </span>
<span id="cb8-17"><a href="#cb8-17"></a>    <span class="co">## find most linear rate in each rep</span></span>
<span id="cb8-18"><a href="#cb8-18"></a>    rmr &lt;-<span class="st"> </span><span class="kw"><a href="../reference/auto_rate.html">auto_rate</a></span>(zeb<span class="op">$</span>dataframe[sr<span class="op">:</span>er, ], <span class="dt">plot =</span> <span class="ot">FALSE</span>)</span>
<span id="cb8-19"><a href="#cb8-19"></a>    </span>
<span id="cb8-20"><a href="#cb8-20"></a>    <span class="co">## save time and rate</span></span>
<span id="cb8-21"><a href="#cb8-21"></a>    rmr_rates[i, <span class="dv">1</span>] &lt;-<span class="st"> </span>sr</span>
<span id="cb8-22"><a href="#cb8-22"></a>    rmr_rates[i, <span class="dv">2</span>] &lt;-<span class="st"> </span>rmr<span class="op">$</span>rate[<span class="dv">1</span>]</span>
<span id="cb8-23"><a href="#cb8-23"></a>}</span>
<span id="cb8-24"><a href="#cb8-24"></a></span>
<span id="cb8-25"><a href="#cb8-25"></a><span class="kw"><a href="https://rdrr.io/r/base/names.html">names</a></span>(rmr_rates) &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"time"</span>, <span class="st">"rmr"</span>)</span></code></pre></div>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1"></a><span class="co">## examine</span></span>
<span id="cb9-2"><a href="#cb9-2"></a><span class="kw"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(rmr_rates)</span>
<span id="cb9-3"><a href="#cb9-3"></a><span class="co">#&gt;   time          rmr</span></span>
<span id="cb9-4"><a href="#cb9-4"></a><span class="co">#&gt; 1 6020 -0.008414331</span></span>
<span id="cb9-5"><a href="#cb9-5"></a><span class="co">#&gt; 2 6680 -0.003999710</span></span>
<span id="cb9-6"><a href="#cb9-6"></a><span class="co">#&gt; 3 7340 -0.006187949</span></span>
<span id="cb9-7"><a href="#cb9-7"></a><span class="co">#&gt; 4 8000 -0.004246525</span></span>
<span id="cb9-8"><a href="#cb9-8"></a><span class="co">#&gt; 5 8660 -0.003727447</span></span>
<span id="cb9-9"><a href="#cb9-9"></a><span class="co">#&gt; 6 9320 -0.002378394</span></span></code></pre></div>
<p>This <code>rmr_rates</code> dataframe contains the start times and most linear rate found in each rep.</p>
</div>
<div id="correcting-for-background" class="section level2">
<h2 class="hasAnchor">
<a href="#correcting-for-background" class="anchor"></a>Correcting for background</h2>
<p>While there is a function in <code>respR</code> for correcting rates for background (<code>adjust_rate</code>), it doesn’t yet support a dynamic background rate (though see example at the end where a formula can be entered in the function if using <code>apply</code> functions). It is in our plans to support this in the future, but for now the rates can be easily corrected using the background correction linear relationship we calculated earlier.</p>
<p>Using the time we saved for each rep we will calculate the appropriate correction factor, and add it to the dataframe.</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1"></a><span class="co">## use time value with lm slope and intercept to get correction factor</span></span>
<span id="cb10-2"><a href="#cb10-2"></a>rmr_rates<span class="op">$</span>adj &lt;-<span class="st"> </span>rmr_rates<span class="op">$</span>time <span class="op">*</span><span class="st"> </span>bg_lm_slp <span class="op">+</span><span class="st"> </span>bg_lm_int</span>
<span id="cb10-3"><a href="#cb10-3"></a><span class="kw"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(rmr_rates)</span>
<span id="cb10-4"><a href="#cb10-4"></a><span class="co">#&gt;   time          rmr           adj</span></span>
<span id="cb10-5"><a href="#cb10-5"></a><span class="co">#&gt; 1 6020 -0.008414331 -7.640036e-05</span></span>
<span id="cb10-6"><a href="#cb10-6"></a><span class="co">#&gt; 2 6680 -0.003999710 -7.681835e-05</span></span>
<span id="cb10-7"><a href="#cb10-7"></a><span class="co">#&gt; 3 7340 -0.006187949 -7.723634e-05</span></span>
<span id="cb10-8"><a href="#cb10-8"></a><span class="co">#&gt; 4 8000 -0.004246525 -7.765433e-05</span></span>
<span id="cb10-9"><a href="#cb10-9"></a><span class="co">#&gt; 5 8660 -0.003727447 -7.807232e-05</span></span>
<span id="cb10-10"><a href="#cb10-10"></a><span class="co">#&gt; 6 9320 -0.002378394 -7.849031e-05</span></span>
<span id="cb10-11"><a href="#cb10-11"></a><span class="kw"><a href="https://rdrr.io/r/utils/head.html">tail</a></span>(rmr_rates)</span>
<span id="cb10-12"><a href="#cb10-12"></a><span class="co">#&gt;      time          rmr           adj</span></span>
<span id="cb10-13"><a href="#cb10-13"></a><span class="co">#&gt; 100 71360 -0.002309671 -0.0001177814</span></span>
<span id="cb10-14"><a href="#cb10-14"></a><span class="co">#&gt; 101 72020 -0.002204660 -0.0001181994</span></span>
<span id="cb10-15"><a href="#cb10-15"></a><span class="co">#&gt; 102 72680 -0.002400156 -0.0001186174</span></span>
<span id="cb10-16"><a href="#cb10-16"></a><span class="co">#&gt; 103 73340 -0.002189404 -0.0001190354</span></span>
<span id="cb10-17"><a href="#cb10-17"></a><span class="co">#&gt; 104 74000 -0.002263608 -0.0001194534</span></span>
<span id="cb10-18"><a href="#cb10-18"></a><span class="co">#&gt; 105 74660 -0.002188329 -0.0001198713</span></span></code></pre></div>
<p>We can see the ultimate correction value is extremely small in comparison to the rate of the specimen, as it should be. We also see it increasing in value in later reps, as it should.</p>
<p>Note, that in <code>respR</code> we have kept rate values as negatives because mathematically they represent depletion of oxygen (although when you come to report these you should change these to positives). So care must be taken when manually using these values to understand the sign and what is being done. Here, to get a final, adjusted RMR rate we <em>subtract</em> the <code>adj</code> value from the RMR rate we calculated.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1"></a>rmr_rates<span class="op">$</span>rmr_adj &lt;-<span class="st"> </span>rmr_rates<span class="op">$</span>rmr <span class="op">-</span><span class="st"> </span>rmr_rates<span class="op">$</span>adj</span>
<span id="cb11-2"><a href="#cb11-2"></a><span class="kw"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(rmr_rates)</span>
<span id="cb11-3"><a href="#cb11-3"></a><span class="co">#&gt;   time          rmr           adj      rmr_adj</span></span>
<span id="cb11-4"><a href="#cb11-4"></a><span class="co">#&gt; 1 6020 -0.008414331 -7.640036e-05 -0.008337931</span></span>
<span id="cb11-5"><a href="#cb11-5"></a><span class="co">#&gt; 2 6680 -0.003999710 -7.681835e-05 -0.003922892</span></span>
<span id="cb11-6"><a href="#cb11-6"></a><span class="co">#&gt; 3 7340 -0.006187949 -7.723634e-05 -0.006110713</span></span>
<span id="cb11-7"><a href="#cb11-7"></a><span class="co">#&gt; 4 8000 -0.004246525 -7.765433e-05 -0.004168870</span></span>
<span id="cb11-8"><a href="#cb11-8"></a><span class="co">#&gt; 5 8660 -0.003727447 -7.807232e-05 -0.003649375</span></span>
<span id="cb11-9"><a href="#cb11-9"></a><span class="co">#&gt; 6 9320 -0.002378394 -7.849031e-05 -0.002299904</span></span></code></pre></div>
<p>If we plot these values (we add the <code>* -1</code> to convert to the usual positive values rates are reported as), we can see after the initial period where the fish was recovering from excercise, the rates stablise. Depending on your experiment, you may choose to average a selection of these to define RMR.</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1"></a><span class="kw"><a href="https://rdrr.io/r/graphics/plot.html">plot</a></span>((rmr_rates<span class="op">$</span>rmr_adj <span class="op">*</span><span class="st"> </span><span class="dv">-1</span>) <span class="op">~</span><span class="st"> </span>rmr_rates<span class="op">$</span>time)</span></code></pre></div>
<p><img src="intermittent2_files/figure-html/unnamed-chunk-13-1.png" width="700"></p>
</div>
<div id="conversion-and-next-steps" class="section level2">
<h2 class="hasAnchor">
<a href="#conversion-and-next-steps" class="anchor"></a>Conversion and next steps</h2>
<p>It depends on your experiment how you might want to define your final RMR. The following is just an example where we define it as the mean of the lowest 10th percentile of adjusted rates (again, because rates are negative be careful with the sign - lowest rates are the highest numerically). We can use the <code>quantile</code> function to get the 10% cutoff value, and take the mean of all values lower than this (again careful - it is highest numerically because they are negative).</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1"></a><span class="co">## 10% quantile cutoff value</span></span>
<span id="cb13-2"><a href="#cb13-2"></a>co &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/stats/quantile.html">quantile</a></span>(rmr_rates<span class="op">$</span>rmr_adj, <span class="fl">0.9</span>)</span>
<span id="cb13-3"><a href="#cb13-3"></a></span>
<span id="cb13-4"><a href="#cb13-4"></a><span class="co">## all rates above cutoff value</span></span>
<span id="cb13-5"><a href="#cb13-5"></a>rt &lt;-<span class="st"> </span>rmr_rates<span class="op">$</span>rmr_adj[rmr_rates<span class="op">$</span>rmr_adj <span class="op">&gt;</span><span class="st"> </span>co]</span>
<span id="cb13-6"><a href="#cb13-6"></a>rt</span>
<span id="cb13-7"><a href="#cb13-7"></a><span class="co">#&gt;  [1] -0.001774937 -0.001598904 -0.001761167 -0.001591412 -0.001593165</span></span>
<span id="cb13-8"><a href="#cb13-8"></a><span class="co">#&gt;  [6] -0.001735911 -0.001775362 -0.001771523 -0.001768999 -0.001767541</span></span>
<span id="cb13-9"><a href="#cb13-9"></a><span class="co">#&gt; [11] -0.001762338</span></span>
<span id="cb13-10"><a href="#cb13-10"></a></span>
<span id="cb13-11"><a href="#cb13-11"></a><span class="co">## Calculate RMR</span></span>
<span id="cb13-12"><a href="#cb13-12"></a>zeb_rmr &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/mean.html">mean</a></span>(rt)</span>
<span id="cb13-13"><a href="#cb13-13"></a></span>
<span id="cb13-14"><a href="#cb13-14"></a><span class="co">## Convert</span></span>
<span id="cb13-15"><a href="#cb13-15"></a><span class="kw"><a href="../reference/convert_rate.html">convert_rate</a></span>(zeb_rmr, <span class="dt">o2.unit =</span> <span class="st">"mg/l"</span>, <span class="dt">time.unit =</span> <span class="st">"s"</span>, <span class="dt">output.unit =</span> <span class="st">"mg/h/g"</span>, </span>
<span id="cb13-16"><a href="#cb13-16"></a>    <span class="dt">mass =</span> <span class="fl">0.001</span>, <span class="dt">volume =</span> <span class="fl">0.1</span>)</span>
<span id="cb13-17"><a href="#cb13-17"></a><span class="co">#&gt; </span></span>
<span id="cb13-18"><a href="#cb13-18"></a><span class="co">#&gt; # convert_rate # ------------------------</span></span>
<span id="cb13-19"><a href="#cb13-19"></a><span class="co">#&gt; Rank/position 1 result shown. To see all results use summary().</span></span>
<span id="cb13-20"><a href="#cb13-20"></a><span class="co">#&gt; Input:</span></span>
<span id="cb13-21"><a href="#cb13-21"></a><span class="co">#&gt; [1] -0.001718296</span></span>
<span id="cb13-22"><a href="#cb13-22"></a><span class="co">#&gt; [1] "mg/L" "sec" </span></span>
<span id="cb13-23"><a href="#cb13-23"></a><span class="co">#&gt; Converted:</span></span>
<span id="cb13-24"><a href="#cb13-24"></a><span class="co">#&gt; [1] -0.6185866</span></span>
<span id="cb13-25"><a href="#cb13-25"></a><span class="co">#&gt; [1] "mg/hour/g"</span></span></code></pre></div>
<p>The MMR value we calculated earlier can also be passed to <code>convert_rate</code> to get the final mass-specific value for this specimen by entering the correct mass (of the fish, in kg) and volume (in L).</p>
<p><strong>Note: the <code>volume</code> is volume of water in the respirometer, not the volume of the respirometer</strong>. That is, it represents the <em>effective volume</em>. A specimen might displace a significant proportion of the water, depending on its size. Therefore the volume of water entered here should equal the volume of the respirometer <strong>minus the volume of the specimen</strong>. It depends on your experiment how you determine water volume. There are several approaches to calculate the volume of a specimen; geometrically, through displacement in a separate vessel, or calculated from the mass and density (e.g. for fish it is often assumed they have an equal density as water, that is ~1000 kg/m^3). Volume could also be determined directly by pouring out the water at the end of the experiment, or by weighing the respirometer. See the <a href="https://github.com/nicholascarey/respfun"><code>respfun</code></a> utilities package for functions to calculate the effective volume and convert water mass to volume.</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1"></a><span class="co">## convert</span></span>
<span id="cb14-2"><a href="#cb14-2"></a><span class="kw"><a href="../reference/convert_rate.html">convert_rate</a></span>(zeb_mmr_adj, <span class="dt">o2.unit =</span> <span class="st">"mg/l"</span>, <span class="dt">time.unit =</span> <span class="st">"s"</span>, <span class="dt">output.unit =</span> <span class="st">"mg/h/g"</span>, </span>
<span id="cb14-3"><a href="#cb14-3"></a>    <span class="dt">mass =</span> <span class="fl">0.001</span>, <span class="dt">volume =</span> <span class="fl">0.1</span>)</span>
<span id="cb14-4"><a href="#cb14-4"></a><span class="co">#&gt; </span></span>
<span id="cb14-5"><a href="#cb14-5"></a><span class="co">#&gt; # convert_rate # ------------------------</span></span>
<span id="cb14-6"><a href="#cb14-6"></a><span class="co">#&gt; Rank/position 1 result shown. To see all results use summary().</span></span>
<span id="cb14-7"><a href="#cb14-7"></a><span class="co">#&gt; Input:</span></span>
<span id="cb14-8"><a href="#cb14-8"></a><span class="co">#&gt; [1] -0.005791542</span></span>
<span id="cb14-9"><a href="#cb14-9"></a><span class="co">#&gt; [1] "mg/L" "sec" </span></span>
<span id="cb14-10"><a href="#cb14-10"></a><span class="co">#&gt; Converted:</span></span>
<span id="cb14-11"><a href="#cb14-11"></a><span class="co">#&gt; [1] -2.084955</span></span>
<span id="cb14-12"><a href="#cb14-12"></a><span class="co">#&gt; [1] "mg/hour/g"</span></span></code></pre></div>
<p>This final value (typically as a positive) is what we report, or use in further analyses.</p>
</div>
<div id="a-complete-analysis" class="section level2">
<h2 class="hasAnchor">
<a href="#a-complete-analysis" class="anchor"></a>A complete analysis</h2>
<p>The above is a long description with the code expanded to show the analysis in detail, so this vignette may not give a good impression of just how succinct a <code>respR</code> analysis of an experiment like this may be. Here is a code block showing the exact same analysis condensed and using a couple of different R approaches (e.g. using <code>apply</code> functions rather than a <code>loop</code>, and <code>list</code> objects to save results). This could be condensed further still depending on how you determine and apply background rates, and if replicates were completely regular or locations already saved to an R object (and condensed still more if you use <code>Tidyverse</code> syntax, see <a href="https://januarharianto.github.io/respR/articles/tidyverse.html">respR and the tidyverse</a>).</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1"></a><span class="co"># Import and inspect raw data ---------------------------------------------</span></span>
<span id="cb15-2"><a href="#cb15-2"></a></span>
<span id="cb15-3"><a href="#cb15-3"></a><span class="co">## importing would normally be the first step, e.g. import_file("path/to/file")</span></span>
<span id="cb15-4"><a href="#cb15-4"></a>z_data &lt;-<span class="st"> </span><span class="kw"><a href="../reference/inspect.html">inspect</a></span>(zeb_intermittent.rd)</span>
<span id="cb15-5"><a href="#cb15-5"></a></span>
<span id="cb15-6"><a href="#cb15-6"></a><span class="co"># Background calculations -------------------------------------------------</span></span>
<span id="cb15-7"><a href="#cb15-7"></a></span>
<span id="cb15-8"><a href="#cb15-8"></a><span class="co">## calculate start and end background, and fit linear model</span></span>
<span id="cb15-9"><a href="#cb15-9"></a>bg_s &lt;-<span class="st"> </span><span class="kw"><a href="../reference/calc_rate.bg.html">calc_rate.bg</a></span>(<span class="kw"><a href="../reference/subset_data.html">subset_data</a></span>(z_data, <span class="dt">from =</span> <span class="dv">0</span>, <span class="dt">to =</span> <span class="dv">4999</span>, <span class="dt">by =</span> <span class="st">"time"</span>))</span>
<span id="cb15-10"><a href="#cb15-10"></a>bg_e &lt;-<span class="st"> </span><span class="kw"><a href="../reference/calc_rate.bg.html">calc_rate.bg</a></span>(<span class="kw"><a href="../reference/subset_data.html">subset_data</a></span>(z_data, <span class="dt">from =</span> <span class="dv">75140</span>, <span class="dt">to =</span> <span class="dv">79251</span>, <span class="dt">by =</span> <span class="st">"time"</span>))</span>
<span id="cb15-11"><a href="#cb15-11"></a></span>
<span id="cb15-12"><a href="#cb15-12"></a><span class="co">## fit lm</span></span>
<span id="cb15-13"><a href="#cb15-13"></a>bg_mod &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(bg_s<span class="op">$</span>bgrate, bg_e<span class="op">$</span>bgrate) <span class="op">~</span><span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="kw"><a href="https://rdrr.io/r/stats/median.html">median</a></span>(bg_s<span class="op">$</span>data<span class="op">$</span>Time), <span class="kw"><a href="https://rdrr.io/r/stats/median.html">median</a></span>(bg_e<span class="op">$</span>data<span class="op">$</span>Time)))</span>
<span id="cb15-14"><a href="#cb15-14"></a></span>
<span id="cb15-15"><a href="#cb15-15"></a><span class="co">## extract slope and intercept</span></span>
<span id="cb15-16"><a href="#cb15-16"></a>bg_mod_int &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/stats/coef.html">coef</a></span>(bg_mod)[<span class="dv">1</span>]</span>
<span id="cb15-17"><a href="#cb15-17"></a>bg_mod_slp &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/stats/coef.html">coef</a></span>(bg_mod)[<span class="dv">2</span>]</span>
<span id="cb15-18"><a href="#cb15-18"></a></span>
<span id="cb15-19"><a href="#cb15-19"></a><span class="co"># Calculate rates in each replicate ---------------------------------------</span></span>
<span id="cb15-20"><a href="#cb15-20"></a><span class="co">## Set start rows of each replicate (remember, first one is 14 mins, all others 11mins)</span></span>
<span id="cb15-21"><a href="#cb15-21"></a>sr &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dv">5000</span>, <span class="kw"><a href="https://rdrr.io/r/base/seq.html">seq</a></span>(<span class="dv">5840</span>, <span class="dv">74300</span>, <span class="dv">660</span>))</span>
<span id="cb15-22"><a href="#cb15-22"></a></span>
<span id="cb15-23"><a href="#cb15-23"></a><span class="co">## apply auto_rate to each rep, from start row (+ 3 mins buffer) to 10 mins (600s) later</span></span>
<span id="cb15-24"><a href="#cb15-24"></a>z_ar &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span>(sr, </span>
<span id="cb15-25"><a href="#cb15-25"></a>               <span class="cf">function</span>(g) <span class="kw"><a href="../reference/auto_rate.html">auto_rate</a></span>(zeb<span class="op">$</span>dataframe[(g<span class="op">+</span><span class="dv">180</span>)<span class="op">:</span>(g<span class="op">+</span><span class="dv">600</span>),], <span class="dt">plot =</span> F))</span>
<span id="cb15-26"><a href="#cb15-26"></a></span>
<span id="cb15-27"><a href="#cb15-27"></a><span class="co"># Adjust rates for background ---------------------------------------------</span></span>
<span id="cb15-28"><a href="#cb15-28"></a><span class="co">## background adjust each rep based on start time of that rep</span></span>
<span id="cb15-29"><a href="#cb15-29"></a>z_ar_adj &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span>(z_ar, </span>
<span id="cb15-30"><a href="#cb15-30"></a>                   <span class="cf">function</span>(g) <span class="kw"><a href="../reference/adjust_rate.html">adjust_rate</a></span>(g, g<span class="op">$</span>df<span class="op">$</span>x[<span class="dv">1</span>] <span class="op">*</span><span class="st"> </span>bg_mod_slp <span class="op">+</span><span class="st"> </span>bg_mod_int))</span>
<span id="cb15-31"><a href="#cb15-31"></a></span>
<span id="cb15-32"><a href="#cb15-32"></a><span class="co"># Convert rates -----------------------------------------------------------</span></span>
<span id="cb15-33"><a href="#cb15-33"></a>z_rates_final &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span>(z_ar_adj, <span class="cf">function</span>(g) <span class="kw"><a href="../reference/convert_rate.html">convert_rate</a></span>(g, </span>
<span id="cb15-34"><a href="#cb15-34"></a>                                                           <span class="dt">o2.unit =</span> <span class="st">"mg/l"</span>,</span>
<span id="cb15-35"><a href="#cb15-35"></a>                                                           <span class="dt">time.unit =</span> <span class="st">"s"</span>,</span>
<span id="cb15-36"><a href="#cb15-36"></a>                                                           <span class="dt">output.unit =</span> <span class="st">"mg/h/g"</span>,</span>
<span id="cb15-37"><a href="#cb15-37"></a>                                                           <span class="dt">mass =</span> <span class="fl">0.001</span>,</span>
<span id="cb15-38"><a href="#cb15-38"></a>                                                           <span class="dt">volume =</span> <span class="fl">0.1</span>))</span>
<span id="cb15-39"><a href="#cb15-39"></a></span>
<span id="cb15-40"><a href="#cb15-40"></a><span class="co"># Extract and define MMR and RMR ------------------------------------------</span></span>
<span id="cb15-41"><a href="#cb15-41"></a></span>
<span id="cb15-42"><a href="#cb15-42"></a><span class="co">## MMR = rate from replicate 1</span></span>
<span id="cb15-43"><a href="#cb15-43"></a>z_mmr &lt;-<span class="st"> </span>z_rates_final[[<span class="dv">1</span>]]<span class="op">$</span>output[<span class="dv">1</span>]</span>
<span id="cb15-44"><a href="#cb15-44"></a></span>
<span id="cb15-45"><a href="#cb15-45"></a><span class="co">## RMR = mean of lowest 10th percentile of all rates (n.b. numerically highest</span></span>
<span id="cb15-46"><a href="#cb15-46"></a><span class="co">## 10th percentile, because of negative sign)</span></span>
<span id="cb15-47"><a href="#cb15-47"></a>z_all_rates &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/lapply.html">sapply</a></span>(z_rates_final, <span class="cf">function</span>(g) g<span class="op">$</span>output[<span class="dv">1</span>])</span>
<span id="cb15-48"><a href="#cb15-48"></a>z_rmr &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/mean.html">mean</a></span>(z_all_rates[z_all_rates <span class="op">&gt;</span><span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/stats/quantile.html">quantile</a></span>(z_all_rates, <span class="fl">0.9</span>)])</span></code></pre></div>
<p>We can see we get same values we calculated above.</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1"></a>z_rmr</span>
<span id="cb16-2"><a href="#cb16-2"></a><span class="co">#&gt; [1] -0.6185866</span></span>
<span id="cb16-3"><a href="#cb16-3"></a>z_mmr</span>
<span id="cb16-4"><a href="#cb16-4"></a><span class="co">#&gt; [1] -2.084955</span></span></code></pre></div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">

        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#experiment-overview">Experiment overview</a></li>
      <li><a href="#loading-and-inspecting-data">Loading and inspecting data</a></li>
      <li><a href="#calculating-background-rate">Calculating background rate</a></li>
      <li><a href="#calculating-mmr">Calculating MMR</a></li>
      <li><a href="#calculating-rmr">Calculating RMR</a></li>
      <li><a href="#correcting-for-background">Correcting for background</a></li>
      <li><a href="#conversion-and-next-steps">Conversion and next steps</a></li>
      <li><a href="#a-complete-analysis">A complete analysis</a></li>
      </ul>
</div>
      </div>

</div>



      <footer><div class="copyright">
  <p>Developed by Januar Harianto, Nicholas Carey.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.4.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
